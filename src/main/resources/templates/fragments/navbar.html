<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
	<!-- Main Navbar -->
	<nav th:fragment="nav-fragment" class="navbar navbar-expand-lg navbar-dark bg-dark">
		<div class="menu-container links-cont">
			<ul>
				<th:block th:each="item : ${menuItems}">
					<th:block th:replace="~{fragments/navbar :: top-level-item(item=${item})}"></th:block>
				</th:block>
			</ul>
		</div>
	</nav>

	<!-- FRAGMENT 1: Top Level (The links visible on the bar) -->
	<th:block th:fragment="top-level-item(item)">
		<li th:if="${#lists.isEmpty(item.children ?: {})}" 
			class="link nav-item" 
			th:classappend="${currentUri == item.href ? 'link-selected' : ''}
				+ ' ' + ${item.cssClass}">
			<a class="nav-link" th:href="@{${item.href}}" th:text="${item.text}"></a>
		</li>

		<li th:if="${not #lists.isEmpty(item.children ?: {})}" class="nav-item dropdown">
			<a class="link nav-link dropdown-toggle" th:classappend="${currentUri.startsWith(item.href) ? 'link-selected' : ''}" 
			href="#" role="button" data-bs-toggle="dropdown" th:text="${item.text}"></a>
			<ul class="dropdown-menu">
				<th:block th:each="child : ${item.children}">
					<!-- SWITCH TO NESTED FRAGMENT for children -->
					<th:block th:replace="~{::nested-item(item=${child})}"></th:block>
				</th:block>
			</ul>
		</li>
	</th:block>

	<!-- FRAGMENT 2: Nested Level (The links inside the dropdowns) -->
	<th:block th:fragment="nested-item(item)">
		<li th:if="${#lists.isEmpty(item.children ?: {})}">
			<a class="link dropdown-item" th:classappend="${currentUri == item.href ? 'link-selected' : ''}" 
			th:href="@{${item.href}}" th:text="${item.text}"></a>
		</li>

		<li th:if="${not #lists.isEmpty(item.children ?: {})}" class="dropdown-submenu">
			<a class="dropdown-item dropdown-toggle" href="#" th:text="${item.text}"></a>
			<ul class="dropdown-menu">
				<th:block th:each="child : ${item.children}">
					<!-- RECURSE using the nested fragment -->
					<th:block th:replace="~{::nested-item(item=${child})}"></th:block>
				</th:block>
			</ul>
		</li>
	</th:block>
</html>
