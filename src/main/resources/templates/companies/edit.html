<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
	xmlns:layout="http://www.ultraq.net.nz"
	layout:decorate="~{layout/default}">
	<body>
        <div layout:fragment="content" class="mt-4"> 
            <div th:if="${saveError}" class="alert alert-danger" th:text="${saveError}"></div>
            <div th:if="${saveSuccess}" class="alert alert-success" th:text="${saveSuccess}"></div>

            <form th:action="@{/companies/save}" th:object="${company}" th:method="post">
                <input type="hidden" th:field="*{companyId}" />
                <div th:if="${company.companyId != null}" class="mb-3">
                    <a th:href="@{/logs/create(companyId=${company.companyId})}" class="btn">
                        <i class="fa-solid fa-plus"></i> Add New Application
                    </a>
                </div>

                <div class="row g-3 mb-3">
                    <div class="col-md-4">
                        <label th:for="companyName" class="form-label">Company Name</label>
                        <input th:field="*{companyName}" type="text" 
                            class="form-control" th:classappend="${#fields.hasErrors('companyName')} ? 'is-invalid' : ''" />
                        <div th:if="${#fields.hasErrors('companyName')}" th:errors="*{companyName}" class="invalid-feedback"></div>
                    </div>

                    <div class="col-md-4">
                        <label th:for="companyEmail" class="form-label">Company Email</label>
                        <input th:field="*{companyEmail}" type="email" class="form-control" />
                    </div>

                    <div class="col-md-4">
                        <label th:for="companyWebsite" class="form-label">Company Website</label>
                        <div class="input-group">
                            <input th:field="*{companyWebsite}" type="text" class="form-control" placeholder="https://..." />
                            <a th:if="*{companyId != null}" th:href="*{companyWebsite}" target="_blank" rel="noopener noreferrer" class="btn btn-outline-secondary" title="Visit Site">
                                <i class="fa-solid fa-arrow-up-right-from-square"></i>
                            </a>
                        </div>
                    </div>
                </div>

                <div class="row g-3 mb-4">
                    <div class="col-md-4">
                        <label th:for="companyPhone" class="form-label">Company Phone</label>
                        <input th:field="*{companyPhone}" type="text" class="form-control" />
                    </div>
                    <div class="col-md-4">
                        <label th:for="companyFax" class="form-label">Company Fax</label>
                        <input th:field="*{companyFax}" type="text" class="form-control" />
                    </div>
                </div>

                <!-- ADDRESSES SECTION -->
                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-light d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Addresses</h5>
                        <button type="button" class="btn btn-sm btn-success" onclick="addAddress()">+ Add Address</button>
                    </div>
                    <div id="address-container">
                        <th:block th:each="addr, iter : ${company.addresses}">
                            <div th:replace="~{fragments/address-row :: addressForm(index=${iter.index})}"></div>
                        </th:block>
                    </div>
                </div>

                <div th:replace="~{fragments/forms :: submit-save-cancel(cancelUrl='/companies')}"></div>
            </form>		
            <template id="address-template">
                <div th:replace="~{fragments/address-row :: addressForm(index=null)}"></div>
            </template>
        </div>
	</body>
</html>
