<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
	xmlns:layout="http://www.ultraq.net.nz"
	layout:decorate="~{layout/default}">
	<body>
        <div layout:fragment="content"> 
            <div th:if="${saveError}" style="color: red;" th:text="'Error: ' + ${saveError}"> Error go here. </div>
            <div th:if="${saveSuccess}" style="color: green;" th:text="${saveSuccess}"> Success go here.  </div>

            <form th:action="@{/companies/update}" th:object="${company}" th:method="post">
                <div class="input-cont -input-cont">
                    <input th:field="*{companyId}" type="hidden" />

                    <label th:for="*{companyName}" class="input-label">Company Name</label>
                    <input th:field="*{companyName}" type="text" class="input text-input" 
                        th:classappend="${#fields.hasErrors('companyName')} ? 'input-error' : ''" />
                    <p th:if="${#fields.hasErrors('companyName')}" th:errors="*{companyName}" class="error-text"></p>

                    <label th:for="*{companyEmail}" class="input-label">Company Email</label>
                    <input th:field="*{companyEmail}" type="text" class="input text-input" />

                    <label th:for="*{companyWebsite}" class="input-label">Company Website</label>
					<div class="input-group">
						<input th:field="*{companyWebsite}" type="text" class="input text-input" />
						<a th:href="*{companyWebsite}" target="_blank"> view </a>
					</div>

                    <label th:for="*{companyPhone}" class="input-label">Company Phone</label>
                    <input th:field="*{companyPhone}" type="text" class="input text-input" />

                    <label th:for="*{companyFax}" class="input-label">Company Fax</label>
                    <input th:field="*{companyFax}" type="text" class="input text-input" />

                    <div class="input-cont addresses-input-cont" id="address-container">
                        <h3 class="input-label">Addresses</h3>
                        <!-- Address List Errors -->
                        <div th:each="addr, iter : *{addresses}" class="input-cont address-group-input-cont inputs-address-group address-row">
                            <!-- Notice the syntax for nested list errors -->
                            <p th:if="${#fields.hasErrors('addresses[' + iter.index + '].street')}" 
                                th:errors="*{addresses[__${iter.index}__].street}"></p>

                            <!-- Hidden field for the Address ID (CRITICAL for updating vs inserting) -->
                            <input type="hidden" th:field="*{addresses[__${iter.index}__].addressId}" />

                            <label th:for="*{addresses[__${iter.index}__].type}" class="input-label">Type</label>
                            <select th:field="*{addresses[__${iter.index}__].type}" class="input text-input">
                                <option value=""> [ Select Type ] </option>
                                <option th:each="t : ${allAddressTypes}" 
                                        th:value="${t.name}" 
                                        th:text="${t.name}">
                                </option>
                            </select>

                            <label th:for="*{addresses[__${iter.index}__].street}" class="input-label">Street</label>
                            <input autocomplete="address-line1" th:field="*{addresses[__${iter.index}__].street}" type="text" class="input text-input" />

                            <label th:for="*{addresses[__${iter.index}__].streetExt}" class="input-label">Suite/Apt</label>
                            <input autocomplete="address-line2" th:field="*{addresses[__${iter.index}__].streetExt}" type="text" class="input text-input" />

                            <label th:for="*{addresses[__${iter.index}__].city}" class="input-label">City</label>
                            <input autocomplete="address-level2" th:field="*{addresses[__${iter.index}__].city}" type="text" class="input text-input" />

                            <label th:for="*{addresses[__${iter.index}__].stateAbbr}" class="input-label">State</label>
                            <select autocomplete="address-level1 region" 
                                th:field="*{addresses[__${iter.index}__].stateAbbr}" 
                                class="input select-input">
                                <option value=""> [ Select State ] </option>
                                <option th:each="st : ${allStates}" 
                                    th:value="${st.abbr}" 
                                    th:data-full-name="${st.name}"
                                    th:text="${st.name}">Idaho</option>
                                </option>
                            </select>

                            <label autocomplete="postal-code" th:for="*{addresses[__${iter.index}__].zip}" class="input-label">Zip</label>
                            <input th:field="*{addresses[__${iter.index}__].zip}" type="text" class="input text-input" />
                            <button type="button" class="btn-danger input submit-input" onclick="this.closest('.address-row').remove()"> Remove This Address </button>
                        </div>
                    </div>
                    <button type="button" class="input submit-input" onclick="addAddress()">+ Add Another Address</button>
				</div>
                <input type="submit" name="save_company" value="Save" class="input submit-input" id="submit-save_company" />
                <input type="button" value="Cancel" class="input submit-input" onclick="location.href='/companies'" />
                <template id="address-template">
                    <div class="address-row-template" th:insert="~{fragments/address-row :: addressForm(index='__INDEX__')}"></div>
                </template>
            </form>		
		</div>
	</body>
</html>
